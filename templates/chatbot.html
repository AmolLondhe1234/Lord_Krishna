<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Krishna</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='chatbot.css') }}">
</head>

<body>

    <div class="--dark-theme" id="chat">
        <audio id="sendSound">
            <source src="{{ url_for('static', filename='music/videoplayback.webm') }}" type="audio/webm">
            Your browser does not support the audio element.
        </audio>
        <h1 class="chatbox-title">The Krishna</h1>
        <div class="chat__conversation-board" id="message-container">
            <!-- Messages will be dynamically added here -->
        </div>
        <div class="chat__conversation-panel">
            <div class="chat__conversation-panel__container">
                <input id="user-input" class="chat__conversation-panel__input panel-item" placeholder="Type a message..." required />
                <button onclick="sendMessage()" class="chat__conversation-panel__button panel-item btn-icon send-message-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    <div class="footer-container">
        <div class="footer">
            <footer>
                <div class="footer-content">
                    <p>&copy; 2024 The Krishna. All rights reserved.</p>
                    <p>Developed by Amol Londhe | Integrated by AgroTech</p>
                </div>
            </footer>
        </div>
    </div>
    <script>
        function sendMessage() {
            var userInput = document.getElementById('user-input').value;
    
            // Display the user's message on the right side
            displayMessage({
                text: userInput,
                reversed: true // Set to true for user messages
            });
    
            // Play the send sound
            var sendSound = document.getElementById('sendSound');
            sendSound.play();
    
            // Send user input to the server
            fetch('/send_message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_input: userInput
                }),
            })
            .then(response => response.json())
            .then(data => {
                // Simulate typing delay for the chatbot's message
                setTimeout(function () {
                    // Update the message object to display on the left side
                    data.chatbot_message.reversed = false;
                    // Add the received message to the chat
                    displayMessage(data.chatbot_message);
                }, 1000); // Adjust the delay duration as needed
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    
            // Clear the user input field
            document.getElementById('user-input').value = '';
        }
    
        // Display a message in the chat
        function displayMessage(message) {
            var messageContainer = document.getElementById('message-container');
    
            var messageHTML = '<div class="chat__conversation-board__message-container ' +
                (message.reversed ? 'reversed' : '') + '">' +
                '<div class="chat__conversation-board__message__context">' +
                '<div class="chat__conversation-board__message__bubble">' +
                '<span>' + message.text + '</span>' +
                '</div>' +
                '</div>' +
                '<div class="chat__conversation-board__message__options">' +
                '<button class="btn-icon chat__conversation-board__message__option-button option-item emoji-button">' +
                '<svg class="feather feather-smile sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">' +
                '<circle cx="12" cy="12" r="10"></circle>' +
                '<path d="M8 14s1.5 2 4 2 4-2 4-2"></path>' +
                '<line x1="9" y1="9" x2="9.01" y2="9"></line>' +
                '<line x1="15" y1="9" x2="15.01" y2="9"></line>' +
                '</svg>' +
                '</button>' +
                '<button class="btn-icon chat__conversation-board__message__option-button option-item more-button">' +
                '<svg class="feather feather-more-horizontal sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">' +
                '<circle cx="12" cy="12" r="1"></circle>' +
                '<circle cx="19" cy="12" r="1"></circle>' +
                '<circle cx="5" cy="12" r="1"></circle>' +
                '</svg>' +
                '</button>' +
                '</div>' +
                '</div>';
    
            messageContainer.innerHTML += messageHTML;
    
            // Scroll to the bottom of the chat container to show the latest message
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }
    </script>    

</body>

</html>
